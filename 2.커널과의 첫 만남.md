# 커널과의 첫 만남

#### 2.1 커널 소스 구하기

- git 혹은 tar 파일 사용



#### 2.2 커널 소스 트리

| 디렉토리      | 설명                                         |
| ------------- | -------------------------------------------- |
| arch          | 특정 아키텍처와 관련된 소스                  |
| block         | 블록 입출력 계층                             |
| crypto        | 암호화 API                                   |
| Documentation | 커널 소스 문서                               |
| drivers       | 장치 드라이버                                |
| firmware      | 특정 드라이버를 사용할 때 필요한 장치 펌웨어 |
| fs            | 가상 파일시스템 및 개별 파일시스템           |
| include       | 커널 헤더 파일                               |
| init          | 커널 시작 및 초기화 관련 코드                |
| ipc           | 프로세스간 통신 관련 코드                    |
| kernel        | 스케줄러와 같은 핵심 커널 서브시스템         |
| lib           | 유틸리티 루틴                                |
| mm            | 메모리 관리 서브시스템 및 가상 메모리        |
| net           | 네트워크 서브시스템                          |
| samplese      | 예제, 데모 코드                              |
| scripts       | 커널을 빌드하는 데 사용하는 스크립트         |
| security      | 리눅스 보안 모듈                             |
| sound         | 사운드 서브시스템                            |
| usr           | 초기 사용자 공간 코드 initramfs              |
| tools         | 리눅스 개발에 유용한도구                     |
| virt          | 가상화 기반 구조                             |



#### 2.3 커널 빌드

- 커널 설정(원하는 config 방식 설정)

  ``` bash
  $ make config
  $ make menuconfig
  $ make defconfig
  $ make oldconfig
  ```

- 커널 빌드

  ``` bash
  $ make
  ```

- 새 커널 설치

  - 커널 이미지를 부트로더 디렉토리에 복사

  ``` bash
  $ make modules_install
  ```



#### 2.4 다른 성질의 야수

- 커널은 C라이브러리나 표준 C 헤더 파일을 사용할 수 없다.
- 커널은 GNU C를 사용한다.
- 커널에는 사용자 공간에서와 같은 메모리 보호 기능이 없다.
- 커널은 부동소수점 연산을 쉽게 실행할 수 없다.
- 커널은 프로세스당 고정된 작은 크기의 스택을 사용한다.
- 커널은 비동기식 인터럽트를 지원하며, 선점형이며, 대칭형 다중 프로세싱을 지원하므로 커널 내에서는 동기화 및 동시성 문제가 매우 중요하다.
- 이식성이 중요하다.
- libc와 표준 헤더 파일을 사용할 수 없음
  - 속도와 크기 문제로 인해 사용 불가
  - libc 함수의 상당수는 커널 안에 구현되어 있다.
  - printf() 대신 printk() 사용
- GNU C
  - 인라인 함수
    - 각 함수 호출이 일어나는 자리의 줄 안에 삽입되는 함수
    - static inline 으로 정의
  - 인라인 어셈블러
    - 일반적인 C함수 안에 어셈블러 명령을 삽입하는 기능을 제공
  - 분기 구문 표시
    - likely(), unlikely()
- 메모리 보호 없음
  - oops 오류 발생
  - 페이징 기능 사용 불가
- 부동 소수점을 쉽게 사용할 수 없음
- 작은 고정 크기의 스택
- 동기화와 동시성
- 이식성의 중요성