# 프로세스 관리

#### 3.1 프로세스

- 실행 중인 프로그램
- 사용 중인 파일, 대기중인 시그널, 커널 내부 데이터, 프로세서 상태, 하나 이상의 물리적 메모리 영역이 할당된 메모리 주소 공간, 실행 중인 하나 이상의 스레드 정보, 전역 데이터가 저장된 부분 등
- 프로그램 코드를 실행하면서 생기는 모든 결과물
- fork()



#### 3.2 프로세스 서술자와 태스크 구조체

- 태스크 리스트
  - 환형 양방향 연결 리스트, 프로세스 목록을 저장
  - struct task_struct: 사용중인 파일, 프로세스 주소 공간, 대기 중인 시그널, 프로세스 상태 등
- 프로세스 서술자 저장
  - PID
  - 최대 값: 시스템에 동시에 존재할 수 있는 최대 프로세스 수
- 프로세스 상태

![](C:\Users\user\Desktop\kernel_study\images\3_1.PNG)



#### 3.3 프로세스 생성

- 프로세스 생성
  - fork()
    - 현재 태스크를 복제해 자식 프로세스를 만든다.
    - PID-PPID
  - exec()
    - 새로운 실행파일을 주소 공간에 불러오고 이를 실행
  - fork() -> exec() 조합으로 사용
  - Copy-on-Write
    - 기록사항 발생 시 복사
    - 데이터 복사를 지연 또는 방지하는 기능
    - 프로세스 주소 공간을 복사하는 대신 부모와 자식 프로세스가 같은 공간을 공유
    - 기록 사항이 발생해 데이터 변경이 필요 => 사본 생성
  - fork(), vfork(), __clone() => clone() => do_fork() => copy_process()
  - copy_process()
    - dup_task_struct()
      - 커널 스택을 새로 만든다.
      - 새 프로세스용 thread_info, task_struct 구조체를 만든다.
      - 새로 만들어진 데이터 값은 현재 태스크와 동일
      - 부모와 자식 프로세스 서술자는 같다.
    - alloc_pid()
      - 새로 만든 태스크에 새로운 PID 값을 할당
    - vfork()
      - 부모 프로세스의 페이지 테이블을 복사하지 않는다.
      - 자식 프로세스는 부모 프로세스의 주소 공간 속에서 별개의 스레드 형태로 실행
      - 부모 프로세스는 자식 프로세스가 exec()을 호출하거나 종료할때까지 대기
      - 현재 커널에서 많이 사용 안함



#### 3.4 리눅스의 스레드 구현

- 스레드 
  - 메모리 주소 공간을 공유하는 같은 프로그램 여러 개를 동시에 실행
  - 사용중인 파일 및 기타 자원을 공유
  - 동시 프로그래밍(concurrent programming) 가능
  - 리눅스 커널에는 별도의 스레드 개념이 없다.
  - 기본적인 프로세스로 모든 스레드를 구현
- 커널 스레드
  - 커널 공간에서만 존재하는 표준 프로세스
  - 조소 공간이 없다.
  - flush 및 ksoftirqd 작어에 사용
  - ps -ef 명령어로 확인 가능



#### 3.5 프로세스 종료

- 부모없는 태스크의 딜레마
  - 부모 프로세스가 자식 프로세스보다 먼저 종료된 경우
  - 다른 프로세스를 자식 프로세스의 부모로 지정해야한다.
  - 그렇지 않으면 좀비 프로세스로 남아 있다.