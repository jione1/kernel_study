# 시스템 호출

#### 5.1 커널과 통신

- 시스템 호출
  - 하드웨어와 사용자 공간 프로세스 사이에 있는 계층
  - 사용자 공간에 하드웨어 인터페이스를 추상화된 형태로 제공
  - 시스템 보안 및 안전성을 제공
  - 프로세스별 가상 시스템 환경을 제공할 수 있다.



#### 5.2 API, POSIX, C 라이브러리

- API (Application Programming Interface)
  - 애플리케이션은 일반적으로 시스템 호출을 직접 사용하지 않고, API를 사용하여 호출
  - 애플리케이션이 사용하는 인터페이스와 커널이 제공하는 인터페이스 사이에 직접적인 연관이 없다.
- POSIX
  - 유닉스에서 가장 유명한 API
  - 유닉스 기반 운영체제 간의 이식성 제공을 목적으로 정해진 IEEE 표준의 집합
- 정책이 아닌 방식을 제공하라 ("Provide mechanism, not policy")
  - 특정 기능을 아주 일반적인 형태로 제공



#### 5.3 시스콜

- 보통 C 라이브러리에 정의된 함수를 호출하는 방식으로 사용
- 정의: asmlinkage 지시자 사용 => 해당 함수의 인자를 스택에서만 찾으시오
- 시스템 호출 번호
  - 특정 시스템 호출을 참조하는데 사용하는 고유 번호
  - 사용자 공간 프로세스가 시스템 호출을 실행할 때 시스콜 번호를 통해 실행할 시스템 호출을 알아낸다.
  - 한번 할당되면 변경 불가
  - sys_ni_syscall(): 구현되지 않은 시스템 호출 => ENOSYS 오류 코드 반환
  - sys_call_table: 등록된 모든 시스템 호출의 목록을 확인
  - arch/i386/kernel/syscall_64.c
- 시스템 호출 성능
  - 다른 운영체제보다 빠른 편
  - 리눅스의 빠른 컨텍스트 전환 시간
  - 시스템 호출 핸들러 및 개별 호출 자체가 간단한다.



#### 5.4 시스템 호출 핸들러

- 사용자 공간의 애플리케이션은 직접 커널 코드를 호출할 수 없다.
- 시스템 호출 핸들러가 예외 처리기
- int $0x80(x86)
- entry_64.s (x86_64)
- x86에서는 eax register 사용

![](C:\Users\user\Desktop\kernel_study\images\5_1.PNG)

- 매개변수 전달
  - 시스템 호출 번호와 함께 하나 이상의 parameter가 필요
  - 가장 쉬운 방법은 매개변수를 레지스터에 저장



#### 5.5 시스템 호출 구현

- 시스템 호출 구현
  - 목적 정의
  - 매개변수 검사
    - 포인터의 유효성 확인
    - copy_to_user(프로세스 주소공간의 목적지 메모리 주소, 커널 공간의 원본 포인터, 복사할 데이터 바이트 크기): 사용자 공간에 쓰기 작업을 함
    - copy_from_user()
    - 권한 유효성 확인
    - <linux/capability.h>



#### 5.6 시스템 호출 커넥스트

- 프로세스 컨텍스트 상태
- current pointer: 시스콜을 호출한 프로세스인 현재 태스크
- 휴면 상태가 될 수 있으며 완전히 선점 가능하다.
- 시스템 호출이 커널의 대다수 기능을 사용할 수 있다.

